"use strict";(self.webpackChunknexopos_4x=self.webpackChunknexopos_4x||[]).push([[9441],{9441:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var i=n(7757),o=n.n(i),r=n(3632),a=n(4679),u=n(2830),s=n(665),d=n(2277),l=n(7700);function c(e,t,n,i,o,r,a){try{var u=e[r](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(i,o)}const p={name:"ns-pos-quick-product-popup",methods:{__:r.__,popupCloser:s.Z,popupResolver:u.Z,close:function(){this.popupResolver(!1)},addProduct:function(){var e,t=this;return(e=o().mark((function e(){var n,i,a,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.validation.extractFields(t.fields),i=t.fields.filter((function(e){return void 0===e.show||"function"==typeof e.show&&e.show(n)})),t.validation.validateFields(i)){e.next=5;break}return e.abrupt("return",l.kX.error((0,r.__)("Unable to proceed. The form is not valid.")).subscribe());case 5:return(a=t.validation.extractFields(i)).$original=function(){return{stock_management:"disabled",category_id:0,tax_group:t.tax_groups.filter((function(e){return parseInt(e.id)===parseInt(a.tax_group_id)}))[0],tax_group_id:a.tax_group_id,tax_type:a.tax_type}},"product"===a.product_type?(a.unit_name=t.units.filter((function(e){return e.id===a.unit_id}))[0].name,a.quantity=parseFloat(a.quantity),a.unit_price=parseFloat(a.unit_price),a.mode="custom",a.price_with_tax=a.unit_price,a.price_without_tax=a.unit_price,a.tax_value=0,a.vendor_id=a.vendor_id):(a.unit_name=(0,r.__)("N/A"),a.unit_price=0,a.quantity=1),e.next=10,POS.defineQuantities(a,t.units);case 10:u=e.sent,a.$quantities=function(){return u},a=POS.computeProductTax(a),POS.addToCart(a),t.close();case 15:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){c(r,i,o,a,u,"next",e)}function u(e){c(r,i,o,a,u,"throw",e)}a(void 0)}))})()},loadData:function(){var e=this;this.loaded=!1,(0,d.D)(nsHttpClient.get("/api/nexopos/v4/units"),nsHttpClient.get("/api/nexopos/v4/taxes/groups"),nsHttpClient.get("/api/nexopos/v4/smp/vendors")).subscribe({next:function(t){e.units=t[0],e.tax_groups=t[1],e.vendors=t[2],e.fields.filter((function(e){"tax_group_id"===e.name&&(e.options=t[1].map((function(e){return{label:e.name,value:e.id}}))),"unit_id"===e.name&&(e.options=t[0].map((function(e){return{label:e.name,value:e.id}}))),"vendor_id"===e.name&&(e.options=t[2].map((function(e){return{label:e.vendor_id,value:e.id}})))})),e.buildForm()},error:function(e){}})},buildForm:function(){this.fields=this.validation.createFields(this.fields),this.loaded=!0}},computed:{form:function(){return this.validation.extractFields(this.fields)}},data:function(){return{units:[],tax_groups:[],vendors:[],loaded:!1,validation:new a.Z,fields:[{label:(0,r.__)("Name"),name:"name",type:"text",description:(0,r.__)("Provide a unique name for the product."),validation:"required"},{label:(0,r.__)("Product Type"),name:"product_type",type:"select",description:(0,r.__)("Define the product type."),options:[{label:(0,r.__)("Normal"),value:"product"},{label:(0,r.__)("Dynamic"),value:"dynamic"}],value:"product",validation:"required"},{label:(0,r.__)("Rate"),name:"rate",type:"text",description:(0,r.__)("In case the product is computed based on a percentage, define the rate here."),validation:"required",show:function(e){return"dynamic"===e.product_type}},{label:(0,r.__)("Unit Price"),name:"unit_price",type:"text",description:(0,r.__)("Define what is the sale price of the item."),validation:"",show:function(e){return"product"===e.product_type}},{label:(0,r.__)("Quantity"),name:"quantity",type:"text",value:1,description:(0,r.__)("Set the quantity of the product."),validation:"",show:function(e){return"product"===e.product_type}},{label:(0,r.__)("Unit"),name:"unit_id",type:"select",options:[],description:(0,r.__)("Assign a unit to the product."),validation:"",show:function(e){return"product"===e.product_type}},{label:(0,r.__)("Tax Type"),name:"tax_type",type:"select",options:[{label:(0,r.__)("Disabled"),value:""},{label:(0,r.__)("Inclusive"),value:"inclusive"},{label:(0,r.__)("Exclusive"),value:"exclusive"}],description:(0,r.__)("Define what is tax type of the item."),show:function(e){return"product"===e.product_type}},{label:(0,r.__)("Tax Group"),name:"tax_group_id",type:"select",options:[],description:(0,r.__)("Choose the tax group that should apply to the item."),show:function(e){return"product"===e.product_type}},{label:(0,r.__)("Vendor Name"),name:"vendor_id",type:"select",options:[],description:(0,r.__)("Choose a vendor for the product."),show:function(e){return"product"===e.product_type}}]}},mounted:function(){this.popupCloser(),this.loadData()}};const _=(0,n(1900).Z)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-95vw flex flex-col h-95vh shadow-lg md:w-3/5-screen lg:w-2/5-screen md:h-3/5-screen ns-box"},[n("div",{staticClass:"header ns-box-header border-b flex justify-between p-2 items-center"},[n("h3",[e._v(e._s(e.__("Product / Service")))]),e._v(" "),n("div",[n("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),n("div",{staticClass:"ns-box-body p-2 flex-auto overflow-y-auto"},[e.loaded?e._e():n("div",{staticClass:"h-full w-full flex justify-center items-center"},[n("ns-spinner")],1),e._v(" "),e.loaded?[e._l(e.fields,(function(t,i){return[t.show&&t.show(e.form)||!t.show?n("ns-field",{key:i,attrs:{field:t}}):e._e()]}))]:e._e()],2),e._v(" "),n("div",{staticClass:"ns-box-footer border-t flex justify-between p-2"},[n("div"),e._v(" "),n("div",[n("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.addProduct()}}},[e._v(e._s(e.__("Create")))])],1)])])}),[],!1,null,null,null).exports}}]);