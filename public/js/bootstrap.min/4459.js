"use strict";(self.webpackChunknexopos_4x=self.webpackChunknexopos_4x||[]).push([[4459],{4459:(t,e,i)=>{i.r(e),i.d(e,{default:()=>v});var n=i(7757),o=i.n(n),r=i(3632),a=i(4679),s=i(2277),u=i(7700);function d(t,e,i,n,o,r,a){try{var s=t[r](a),u=s.value}catch(t){return void i(t)}s.done?e(u):Promise.resolve(u).then(n,o)}var l,c,p;const _=(l={name:"ns-pos-product",methods:{__:r.__,addQuickProduct:function(){var t,e=this;return(t=o().mark((function t(){var i,n,a,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.validation.extractFields(e.fields),n=e.fields.filter((function(t){return void 0===t.show||"function"==typeof t.show&&t.show(i)})),e.validation.validateFields(n)){t.next=5;break}return t.abrupt("return",u.kX.error((0,r.__)("Unable to proceed. The form is not valid.")).subscribe());case 5:return(a=e.validation.extractFields(n)).$original=function(){return{stock_management:"disabled",category_id:0,tax_group:e.tax_groups.filter((function(t){return parseInt(t.id)===parseInt(a.tax_group_id)}))[0],tax_group_id:a.tax_group_id,tax_type:a.tax_type}},"product"===a.product_type?(a.unit_name=e.units.filter((function(t){return t.id===a.unit_id}))[0].name,a.quantity=parseFloat(a.quantity),a.unit_price=parseFloat(a.unit_price),a.mode="custom",a.price_with_tax=a.unit_price,a.price_without_tax=a.unit_price,a.tax_value=0,a.vendor_id=a.vendor_id):(a.unit_name=(0,r.__)("N/A"),a.unit_price=0,a.quantity=1),t.next=10,POS.defineQuantities(a,e.units);case 10:s=t.sent,a.$quantities=function(){return s},a=POS.computeProductTax(a),POS.addToCart(a),e.resetForm(),e.buildForm();case 16:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(n,o){var r=t.apply(e,i);function a(t){d(r,n,o,a,s,"next",t)}function s(t){d(r,n,o,a,s,"throw",t)}a(void 0)}))})()},loadData:function(){var t=this;this.loaded=!1,(0,s.D)(nsHttpClient.get("/api/nexopos/v4/units"),nsHttpClient.get("/api/nexopos/v4/taxes/groups"),nsHttpClient.get("/api/nexopos/v4/smp/vendors")).subscribe({next:function(e){t.units=e[0],t.tax_groups=e[1],t.vendors=e[2],t.fields.filter((function(t){"tax_group_id"===t.name&&(t.options=e[1].map((function(t){return{label:t.name,value:t.id}}))),"unit_id"===t.name&&(t.options=e[0].map((function(t){return{label:t.name,value:t.id}}))),"vendor_id"===t.name&&(t.options=e[2].map((function(t){return{label:t.vendor_id,value:t.id}})))})),t.buildForm()},error:function(t){}})},resetForm:function(){this.fields.forEach((function(t){"name"==t.name&&(t.value=void 0),"unit_price"==t.name&&(t.value=void 0)}))},buildForm:function(){this.fields=this.validation.createFields(this.fields),this.loaded=!0}},computed:{form:function(){return this.validation.extractFields(this.fields)},isVisible:function(){return"product"===this.visibleSection}},mounted:function(){var t=this;this.visibleSectionSubscriber=POS.visibleSection.subscribe((function(e){t.visibleSection=e}))},destroyed:function(){this.visibleSectionSubscriber.unsubscribe()},data:function(){return{units:[],tax_groups:[],vendors:[],visibleSection:null,visibleSectionSubscriber:null,loaded:!1,validation:new a.Z,fields:[{label:(0,r.__)("Vendor Name"),name:"vendor_id",type:"select",options:[],description:(0,r.__)("Choose a vendor for the product."),show:function(t){return"product"===t.product_type}},{label:(0,r.__)("Name"),name:"name",type:"text",description:(0,r.__)("Provide a unique name for the product."),validation:"required"},{label:(0,r.__)("Rate"),name:"rate",type:"text",description:(0,r.__)("In case the product is computed based on a percentage, define the rate here."),validation:"required",show:function(t){return"dynamic"===t.product_type}},{label:(0,r.__)("Unit Price"),name:"unit_price",type:"text",description:(0,r.__)("Define what is the sale price of the item."),validation:"",show:function(t){return"product"===t.product_type}},{label:(0,r.__)("Unit"),name:"unit_id",type:"select",options:[],description:(0,r.__)("Assign a unit to the product."),validation:"required",show:function(t){return"product"===t.product_type}},{label:(0,r.__)("Quantity"),name:"quantity",type:"text",value:1,description:(0,r.__)("Set the quantity of the product."),validation:"",show:function(t){return"product"===t.product_type}},{label:(0,r.__)("Tax Type"),name:"tax_type",type:"select",options:[{label:(0,r.__)("Disabled"),value:""},{label:(0,r.__)("Inclusive"),value:"inclusive"},{label:(0,r.__)("Exclusive"),value:"exclusive"}],description:(0,r.__)("Define what is tax type of the item."),show:function(t){return"product"===t.product_type}},{label:(0,r.__)("Tax Group"),name:"tax_group_id",type:"select",options:[],description:(0,r.__)("Choose the tax group that should apply to the item."),show:function(t){return!1}},{label:(0,r.__)("Product Type"),name:"product_type",type:"select",description:(0,r.__)("Define the product type."),options:[{label:(0,r.__)("Normal"),value:"product"},{label:(0,r.__)("Dynamic"),value:"dynamic"}],value:"product"}]}}},p=function(){this.loadData()},(c="mounted")in l?Object.defineProperty(l,c,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[c]=p,l);var f=(0,i(1900).Z)(_,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flex-auto flex flex-col",attrs:{id:"pos-product"}},["product"===t.visibleSection?i("div",{staticClass:"flex pl-2",attrs:{id:"tools"}},[i("div",{staticClass:"switch-cart flex cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 border-t border-r border-l",on:{click:function(e){return t.switchTo("cart")}}},[i("span",[t._v(t._s(t.__("Cart")))]),t._v(" "),t.order?i("span",{staticClass:"products-count flex items-center justify-center text-sm rounded-full h-6 w-6 ml-1"},[t._v(t._s(t.order.products.length))]):t._e()]),t._v(" "),i("div",{staticClass:"switch-grid cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 font-semibold",on:{click:function(e){return t.switchTo("product")}}},[t._v("\n      "+t._s(t.__("Products"))+"\n    ")])]):t._e(),t._v(" "),i("div",{staticClass:"rounded shadow ns-tab-item flex-auto flex overflow-hidden"},[i("div",{staticClass:"cart-table flex flex-auto flex-col overflow-hidden"},[i("div",{staticClass:"header ns-box-header border-b flex justify-between p-2 items-center"},[i("h3",[t._v(t._s(t.__("Product / Service")))])]),t._v(" "),i("div",{staticClass:"ns-box-body p-2 flex-auto overflow-y-auto"},[t.loaded?t._e():i("div",{staticClass:"h-full w-full flex justify-center items-center"},[i("ns-spinner")],1),t._v(" "),t.loaded?[t._l(t.fields,(function(e,n){return[e.show&&e.show(t.form)||!e.show?i("ns-field",{key:n,attrs:{field:e}}):t._e()]}))]:t._e()],2),t._v(" "),i("div",{staticClass:"ns-box-footer border-t flex justify-between p-2"},[i("div"),t._v(" "),i("div",[i("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.addQuickProduct()}}},[t._v(t._s(t.__("Create")))])],1)])])])])}),[],!1,null,null,null);const v=f.exports}}]);